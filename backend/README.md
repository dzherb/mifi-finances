# Finances Manager API

___
## Запуск проекта

1. Для установки зависимостей понадобится пакетный менеджер [uv](https://docs.astral.sh/uv/). Он сам позаботится о нужной версии Python, достаточно выполнить следующую команду, находясь в каталоге `backend`:
    ```bash
    uv sync
    ```
   Будет создан каталог `.venv`. Теперь активируем виртуальное окружение:
   ```bash
   # для linux/macos
   source .venv/bin/activate
   # для windows
   .venv\Scripts\activate.bat
   ```
2. Далее нужно создать в каталоге `backend` файл `.env` по примеру `.env.template`. Там же задается строка для подключения к postgreSQL. Его можно поднять любым удобным образом, например, в отдельном контейнере с открытым портом.
3. Применяем миграции (см. ниже отдельный раздел про миграции)
4. Запускаем dev-сервер, по умолчанию на порте 8000:
   ```bash
   uvicorn main:app
   ```
   Если все прошло ок, то будет доступен адрес http://127.0.0.1:8000/docs
___
## Используемые в разработке инструменты

### Линтеры

Линтеры помогают держать кодовую базу в едином стиле и избегать глупых ошибок. [Ruff](https://docs.astral.sh/ruff/) не только следит за применением PEP 8 и другими best practices, но еще и умеет форматировать исходный код, причем делает это очень быстро.

#### Применить линтеры
```bash
ruff check --fix .
```
Команда выше выведет все проблемные места и применит фиксы там, где это можно сделать автоматически. Список актуальных правил для проверки лежит в `ruff.toml`

#### Отформатировать код
```bash
ruff format .
```

### Type checking 

Одних линтеров может быть недостаточно чтобы выловить все возможные баги еще до запуска кода. Тут на помощь приходит [mypy](https://mypy.readthedocs.io/en/stable/index.html), статический type cheker для Python. Можно сказать, что он решает ту же проблему, что и TypeScript по отношению к JavaScript, но использует уже существующий в языке механизм аннотаций.

#### Проверить типизацию
```bash
mypy .
```



### Миграции

С помощью миграций мы можем версионировать состояние базы данных. Например, после добавления в коде новой модели или изменения полей у существующей. 

В проекте для этой цели используется [Alembic](https://alembic.sqlalchemy.org/en/latest/index.html).

#### Создать новую миграцию
```bash
alembic revision --autogenerate -m "revision message"
```
**Важно!** Автогенерация не всегда делает что мы ожидаем, хорошим тоном будет пройтись по созданному файлу и убедиться, что в нем все корректно. 

Сообщение к миграции лучше оставлять короткими и по делу, в духе commit message. Например:
- "add name field"
- "delete users table"

и т.п.

Также стоит следить за тем, чтобы миграции были как можно более атомарными. Плохо, когда в одной миграции добавляем сразу три таблицы и удаляем кучу полей.
#### Применить актуальную миграцию
```bash
alembic upgrade head
```
Эту же команду можно запускать и на пустой БД. Alembic применит все необходимые миграции от текущего состояния БД до актуальной версии.